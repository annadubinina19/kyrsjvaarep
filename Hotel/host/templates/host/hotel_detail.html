<!DOCTYPE html>
{% load customtags %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ hotel.name }} - –ü—É—Ç–µ—à–µ—Å—Ç–≤—É–π —Å –Ω–∞–º–∏</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/rooms.css' %}">
    <script src="{% static 'js/logg.js' %}"></script>
    <script src="{% static 'js/reviews.js' %}"></script>
    <script src="{% static 'js/booking.js' %}"></script>
    <script>
        const hotelId = {{ hotel.id }};
    </script>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="logo">
                <h1>{% site_title %}</h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="#">–¢—É—Ä—ã</a></li>
                    <li><a href="#">–û –Ω–∞—Å</a></li>
                    <li><a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                {% if request.session.user_id %}
                    <div class="user-info">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ request.session.user_name }}!</div>
                    <a href="/profile/" class="profile-btn">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    <a href="/logout/" class="logout-btn">–í—ã—Ö–æ–¥</a>
                {% else %}
                    <a href="#" class="login-button" onclick="openLoginModal()">–í—Ö–æ–¥</a>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="hotel-detail">
        <!-- –°–µ–∫—Ü–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–µ–ª–µ -->
        <section class="hotel-info-section">
            <div class="hotel-header">
                <div class="hotel-main-info">
                    <h1>{{ hotel.name }}</h1>
                    <div class="hotel-rating">
                        <span class="stars">
                            {% for _ in hotel.rating|get_range %}
                                ‚≠ê
                            {% endfor %}
                        </span>
                        <span class="rating-number">{{ hotel.rating }}/5</span>
                    </div>
                    <p class="hotel-location">üìç {{ hotel.location }}</p>
                </div>
                {% if hotel.website %}
                    <a href="{{ hotel.website }}" class="hotel-website-btn" target="_blank">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç</a>
                {% endif %}
            </div>

            <div class="hotel-content">
                {% if hotel.photo %}
                    <div class="hotel-main-photo">
                        <img src="{{ hotel.photo.url }}" alt="{{ hotel.name }}">
                    </div>
                {% endif %}
                
                <div class="hotel-details">
                    <div class="detail-block">
                        <h3>–û–± –æ—Ç–µ–ª–µ</h3>
                        <p>{{ hotel.description }}</p>
                    </div>
                    
                    <div class="detail-block">
                        <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        <p>üìû {{ hotel.contact_info }}</p>
                        {% if hotel.booking_url %}
                            <a href="{{ hotel.booking_url }}" class="book-hotel-btn" target="_blank">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–∞–π—Ç–µ –æ—Ç–µ–ª—è</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è —Å –Ω–æ–º–µ—Ä–∞–º–∏ -->
        <section class="rooms-section">
            <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–æ–º–µ—Ä–∞</h2>
            <div class="rooms-grid">
                {% get_rooms_by_hotel hotel.id as rooms %}
                {% for room in rooms %}
                    <div class="room-card">
                        {% if room.photo %}
                            <div class="room-photo">
                                <img src="{{ room.photo.url }}" alt="–ù–æ–º–µ—Ä {{ room.get_room_type_display }}">
                            </div>
                        {% endif %}
                        <div class="room-info">
                            <h3>{{ room.get_room_type_display }}</h3>
                            <div class="room-details">
                                <p class="room-price">{{ room.price_per_night|currency_format }} –∑–∞ –Ω–æ—á—å</p>
                                <p class="room-capacity">–î–æ {{ room.max_guests }} –≥–æ—Å—Ç–µ–π</p>
                            </div>
                            <button class="book-room-btn" data-room-id="{{ room.id }}" onclick="bookRoom(this)">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    </div>
                {% empty %}
                    <p class="no-rooms">–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤</p>
                {% endfor %}
            </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è —Å –æ—Ç–∑—ã–≤–∞–º–∏ -->
        <section class="reviews-section">
            <h2>–û—Ç–∑—ã–≤—ã –≥–æ—Å—Ç–µ–π</h2>
            
            {% if request.session.user_id %}
                <div class="add-review-button">
                    <button onclick="openReviewModal()" class="add-review-btn">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
                </div>
            {% endif %}

            <div class="reviews-grid">
                {% for review in hotel.review_set.all %}
                    <div class="review-card" id="review-{{ review.id }}">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <h3>{{ review.user.first_name }} {{ review.user.last_name }}</h3>
                                <p class="review-date">{{ review.created_at|date:"d.m.Y" }}</p>
                            </div>
                            <div class="review-rating">
                                <span class="stars">
                                    {% for _ in review.rating|get_range %}
                                        ‚≠ê
                                    {% endfor %}
                                </span>
                                <span class="rating-number">{{ review.rating }}/5</span>
                            </div>
                        </div>
                        <div class="review-content">
                            <p>{{ review.comment }}</p>
                        </div>
                        {% if request.session.user_id == review.user.id %}
                            <div class="review-actions">
                                <button onclick="openEditReviewModal({{ review.id }}, '{{ review.comment|escapejs }}', {{ review.rating }})" class="edit-review-btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button onclick="deleteReview({{ review.id }})" class="delete-review-btn">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        {% endif %}
                    </div>
                {% empty %}
                    <p class="no-reviews">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –æ–± —ç—Ç–æ–º –æ—Ç–µ–ª–µ</p>
                {% endfor %}
            </div>
        </section>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReviewModal()">&times;</span>
            <h2>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h2>
            <form id="reviewForm" onsubmit="submitReview(event)">
                <div class="rating-select">
                    <label>–û—Ü–µ–Ω–∫–∞:</label>
                    <select name="rating" required>
                        <option value="5">5 ‚≠ê</option>
                        <option value="4">4 ‚≠ê</option>
                        <option value="3">3 ‚≠ê</option>
                        <option value="2">2 ‚≠ê</option>
                        <option value="1">1 ‚≠ê</option>
                    </select>
                </div>
                <div class="comment-input">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                    <textarea name="comment" required></textarea>
                </div>
                <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞ -->
    <div id="editReviewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditReviewModal()">&times;</span>
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∑—ã–≤</h2>
            <form id="editReviewForm" onsubmit="submitEditReview(event)">
                <input type="hidden" name="review_id" id="edit_review_id">
                <div class="rating-select">
                    <label>–û—Ü–µ–Ω–∫–∞:</label>
                    <select name="rating" id="edit_rating" required>
                        <option value="5">5 ‚≠ê</option>
                        <option value="4">4 ‚≠ê</option>
                        <option value="3">3 ‚≠ê</option>
                        <option value="2">2 ‚≠ê</option>
                        <option value="1">1 ‚≠ê</option>
                    </select>
                </div>
                <div class="comment-input">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                    <textarea name="comment" id="edit_comment" required></textarea>
                </div>
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—Ö–æ–¥–∞ -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <div id="loginForm">
                <h2>–í—Ö–æ–¥</h2>
                <div id="login-message" class="message"></div>
                <form id="login-form" method="POST" action="/login/">
                    {% csrf_token %}
                    <input type="email" name="email" placeholder="Email" required>
                    <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    <button type="submit">–í–æ–π—Ç–∏</button>
                </form>
                <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showRegisterForm()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
            </div>
            <div id="registerForm" style="display:none;">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <div id="register-message" class="message"></div>
                <form id="register-form" method="POST" action="/register/">
                    {% csrf_token %}
                    <input type="text" name="last_name" placeholder="–§–∞–º–∏–ª–∏—è" required>
                    <input type="text" name="first_name" placeholder="–ò–º—è" required>
                    <input type="email" name="email" placeholder="Email" required>
                    <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    <input type="tel" name="phone_number" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
                    <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </form>
                <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="showLoginForm()">–í–æ–π—Ç–∏</a></p>
            </div>
        </div>
    </div>
</body>
</html>