<!DOCTYPE html>
{% load customtags %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—É—Ç–µ—à–µ—Å—Ç–≤—É–π —Å –Ω–∞–º–∏</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/maain.css' %}">
    <script src="{% static 'js/logg.js' %}"></script>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <div class="logo">
                <h1>{% site_title %}</h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="#">–¢—É—Ä—ã</a></li>
                    <li><a href="#">–û –Ω–∞—Å</a></li>
                    <li><a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                {% if request.session.user_id %}
                    <div class="user-info">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ request.session.user_name }}!</div>
                    <a href="/profile/" class="profile-btn">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    <a href="/logout/" class="logout-btn">–í—ã—Ö–æ–¥</a>
                {% else %}
                    <a href="#" class="login-button" onclick="openLoginModal()">–í—Ö–æ–¥</a>
                {% endif %}
            </div>
        </div>
    </header>
    <main>
    <section class="search-section">
        <div class="search-container">
            <h2>–ù–∞–π–¥–∏ –æ—Ç–µ–ª—å —Å–≤–æ–µ–π –º–µ—á—Ç—ã</h2>
            <form action="{% url 'search' %}" method="get" class="search-form">
                <input type="text" name="location" placeholder="–ì–æ—Ä–æ–¥" required>
                <input type="date" name="check_in" required min="{{ today }}">
                <button type="submit">–ü–æ–∏—Å–∫</button>
            </form>
        </div>
    </section>

    <!-- –°–µ–∫—Ü–∏—è —Å –∞–∫—Ü–∏—è–º–∏ -->
     <h2>–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h2>
    <section class="promotions-section">
        <div class="container">
            {% if active_promotions %}
                <div class="promotions-grid">
                    {% for promotion in active_promotions %}
                        <div class="promotion-card">
                            <div class="promotion-content">
                                <h3>{{ promotion.title }}</h3>
                                <p class="promotion-hotel">üè® {{ promotion.hotel.name }}</p>
                                <p class="promotion-dates">üìÖ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ {{ promotion.end_date|date:"d.m.Y" }}</p>
                                {% if promotion.description %}
                                    <p class="promotion-description">{{ promotion.description|truncatewords:30 }}</p>
                                {% endif %}
                                <div class="promotion-buttons">
                                    <a href="{% url 'hotel_detail' hotel_id=promotion.hotel.id %}" class="view-rooms-btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–æ–º–µ—Ä–∞</a>
                                    {% if promotion.details_url %}
                                        <a href="{{ promotion.details_url }}" class="details-btn" target="_blank">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∞–∫—Ü–∏–∏</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="no-promotions">–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ü–∏–π</p>
            {% endif %}
        </div>
    </section>

    <!-- –°–µ–∫—Ü–∏—è —Å –æ—Ç–∑—ã–≤–∞–º–∏ -->
     <h2>–õ—É—á—à–∏–µ –æ—Ç–∑—ã–≤—ã</h2>
    <section class="reviews-section">
        <div class="container">
            {% if top_reviews %}
                <div class="reviews-grid">
                    {% for review in top_reviews %}
                        <div class="review-card">
                            <div class="review-header">
                                <div class="review-hotel">
                                    <h3>{{ review.hotel.name }}</h3>
                                    <p class="hotel-location">üìç {{ review.hotel.location }}</p>
                                </div>
                                <div class="review-rating">
                                    <div class="stars">
                                        {% for _ in review.rating|get_range %}
                                            ‚≠ê
                                        {% endfor %}
                                    </div>
                                    <span class="rating-number">{{ review.rating }}/5</span>
                                </div>
                            </div>
                            <div class="review-content">
                                <p class="review-text">{{ review.comment|truncatewords:30 }}</p>
                            </div>
                            <div class="review-footer">
                                <div class="reviewer-info">
                                    <p class="reviewer-name">{{ review.user.first_name }} {{ review.user.last_name }}</p>
                                    <p class="review-date">{{ review.created_at|date:"d.m.Y" }}</p>
                                </div>
                                <a href="{% url 'hotel_detail' hotel_id=review.hotel.id %}" class="view-hotel-btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–µ–ª—å</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="no-reviews">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º</p>
            {% endif %}
        </div>
    </section>

    <h2>–¢–æ–ø –æ—Ç–µ–ª–µ–π</h2>
    <section class="top-hotels">
        <div class="container">
            {% if no_hotels %}
                <div class="no-hotels-message">
                    <h3>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ç–µ–ª–µ–π</h3>
                    <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –ª—É—á—à–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –≤–∞—Å!</p>
                </div>
            {% else %}
                <div class="hotels-grid">
                    {% for hotel in top_hotels %}
                        <div class="hotel-card">
                            {% if hotel.photo %}
                                <div class="hotel-image">
                                    <img src="{{ hotel.photo_url }}" alt="{{ hotel.name }}">
                                </div>
                            {% endif %}
                            <div class="hotel-info">
                                <h3>{{ hotel.name }}</h3>
                                <p class="hotel-location">üìç {{ hotel.location }}</p>
                                <div class="hotel-rating">
                                    <span class="stars">
                                        {% for _ in hotel.rating_range %}
                                            ‚≠ê
                                        {% endfor %}
                                    </span>
                                    <span class="rating-number">{{ hotel.rating }}/5</span>
                                </div>
                                <p class="hotel-description">{{ hotel.description|truncatewords:20 }}</p>
                                <a href="{% url 'hotel_detail' hotel_id=hotel.id %}" class="view-hotel-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                {% if city_stats %}
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–æ—Ä–æ–¥–∞–º -->
                    <div class="city-stats">
                        <h3>–†–µ–π—Ç–∏–Ω–≥ –≥–æ—Ä–æ–¥–æ–≤</h3>
                        <div class="stats-grid">
                            {% for stat in city_stats %}
                                <div class="city-stat-card">
                                    <h4>{{ stat.location }}</h4>
                                    <p>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: {{ stat.avg_rating|floatformat:1 }}</p>
                                    <p>–û—Ç–µ–ª–µ–π: {{ stat.hotel_count }}</p>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                {% if cities %}
                    <!-- –°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ -->
                    <div class="cities-list">
                        <h3>–í—Å–µ –≥–æ—Ä–æ–¥–∞</h3>
                        <div class="city-tags">
                            {% for city in cities %}
                                <span class="city-tag">{{ city }}</span>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </section>
    </main>
    <div id="loginModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeLoginModal()">&times;</span>

    <!-- –§–û–†–ú–ê –í–•–û–î–ê -->
    <div id="loginForm">
      <h2>–í—Ö–æ–¥</h2>
      <div id="login-message" class="message"></div>
      <form id="login-form" method="POST" action="/login/">
        {% csrf_token %}
        <input type="email" name="email" placeholder="Email" required><br>
        <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required><br>
        <button type="submit">–í–æ–π—Ç–∏</button>
      </form>
      <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showRegisterForm()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
    </div>

    <!-- –§–û–†–ú–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
    <div id="registerForm" style="display:none;">
      <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <div id="register-message" class="message"></div>
      <form id="register-form" method="POST" action="/register/">
        {% csrf_token %}
        <input type="text" name="last_name" placeholder="–§–∞–º–∏–ª–∏—è" required><br>
        <input type="text" name="first_name" placeholder="–ò–º—è" required><br>
        <input type="email" name="email" placeholder="Email" required><br>
        <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required><br>
        <input type="tel" name="phone_number" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required><br>
        <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      </form>
      <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="showLoginForm()">–í–æ–π—Ç–∏</a></p>
    </div>
    
    </div>
  

</body>

</html>